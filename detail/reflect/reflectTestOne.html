<!DOCTYPE html>
<html>
<head>
    <title> BE YOURSELF </title>

    <!-- meta -->
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <!-- css -->
    <link rel="stylesheet" href="../../css/bootstrap.min.css">
    <link rel="stylesheet" href="http://code.ionicframework.com/ionicons/2.0.1/css/ionicons.min.css">
    <link rel="stylesheet" href="../../css/pace.css">
    <link rel="stylesheet" href="../../css/custom.css">

    <!-- js -->
    <script src="../../js/jquery-2.1.3.min.js"></script>
    <script src="../../js/bootstrap.min.js"></script>
    <script src="../../js/pace.min.js"></script>
    <script src="../../js/modernizr.custom.js"></script>
</head>

<body id="single">
<div class="container">
    <header id="site-header">
        <div class="row">
            <div class="col-md-4 col-sm-5 col-xs-8">
                <div class="logo">
                    <h1><a href="index.html"> BE YOURSELF </a></h1>
                </div>
            </div><!-- col-md-4 -->
            <div class="col-md-8 col-sm-7 col-xs-4">
                <nav class="main-nav" role="navigation">
                    <div class="navbar-header">
                        <button type="button" id="trigger-overlay" class="navbar-toggle">
                            <span class="ion-navicon"></span>
                        </button>
                    </div>

                    <div class="collapse navbar-collapse" id="bs-example-navbar-collapse-1">
                        <ul class="nav navbar-nav navbar-right">
                            <li class="cl-effect-11"><a href="../../index.html" data-hover="首页">HOME</a></li>
                            <li class="cl-effect-11"><a href="../../full-width.html" data-hover="博客">BLOG</a></li>
                            <li class="cl-effect-11"><a href="../../about.html" data-hover="关于">ABOUT</a></li>
                        </ul>
                    </div><!-- /.navbar-collapse -->
                </nav>
            </div><!-- col-md-8 -->
        </div>
    </header>
</div>


<div class="content-body">
    <div class="container">
        <div class="row">
            <main class="col-md-8">
                <article class="post post-1">
                    <header class="entry-header">
                        <h1 class="entry-title"> &nbsp; -- 反射 -- &nbsp; &nbsp; REFLECT TESTING - 1.0 </h1>
                        <div class="entry-meta">
                            <span class="post-category"><a href="#">programKingdom</a></span>
                            <span class="post-date"><a href="#"><time class="entry-date"
                                                                      datetime="2012-11-09T23:15:57+00:00">2020-01-10</time></a></span>
                        </div>
                    </header>
                    <div class="entry-content clearfix">
                        <textarea name="" class="panel-body" id="" rows="20"  disabled="disabled" style="display: inline-block;width: 100% ; height: 100%;background-color: #f5f5f5;color: #212529">
   package main

import (
	"bytes"
	"fmt"
	"log"
	"reflect"
)

func main(){
	// --- 测试数据 START
	var (
		data  []byte
		err	  error
		Msg = struct{
				Name string
				Age  int
			}{
				Name:"programKingdom",
				Age:23,
			}
	)
	// --- END

	//调用
	if data ,err = Marshal(Msg);err != nil {
		log.Fatal(err)
		return
	}
	//打印输出
		fmt.Printf("%s \n",data)
		return
}
//入口
func Marshal(v interface{})([]byte,error){
	var buf bytes.Buffer
	if err := encode(&buf,reflect.ValueOf(v));err != nil{
		return nil,err
	}
	return buf.Bytes(),nil
}

//TESTING 1.0
func encode(buf *bytes.Buffer,v reflect.Value)(error){
	//表示类型表示的特定类型。
	switch v.Kind() {

		case reflect.Invalid:
		 	buf.WriteString("nil")

		case reflect.Int,reflect.Int8,reflect.Int16,reflect.Int64,reflect.Int32:
		 	fmt.Fprintf(buf,"%d",v.Int())

		case reflect.Uint,reflect.Uint8,reflect.Uint16,reflect.Uint32,reflect.Uint64:
			fmt.Fprintf(buf,"%d",v.Uint())

		case reflect.String:
			fmt.Fprintf(buf,"%q",v.String())

		case reflect.Ptr:
			//v.Elem() 返回接口v包含的值
			return encode(buf,v.Elem())

		case reflect.Array,reflect.Slice:
			buf.WriteByte('(')
			// v.NumField()  NumField返回结构v中的字段数。
			for i:= 0 ;i < v.NumField();i++{
				if  i > 0 {
					//格式化
					buf.WriteByte(' ')
				}
				//递归调用检索字段类型
				if err := encode(buf,v.Index(i));err != nil {
					return  err
				}
				buf.WriteByte(')')
			}

		case reflect.Struct:
			buf.WriteByte('(')
			for i:= 0;i < v.NumField();i++ {
				//获取结构体的字段名称 v.Type().Field(i).Name
				fmt.Fprintf(buf,"(%s ",v.Type().Field(i).Name)
				if err := encode(buf,v.Field(i));err != nil {
					return  err
				}
					buf.WriteByte(')')
			}
			buf.WriteByte(')')

		case reflect.Map:
			buf.WriteByte('(')
			// v.MapKeys() 返回一个包含映射中所有键的片段
			for i, key := range v.MapKeys() {
				if i > 0  {
					buf.WriteByte(' ')
				}
				buf.WriteByte('(')
				//递归调用
				if err := encode(buf,key);err != nil {
					return err
				}
				buf.WriteByte(' ')
				//递归调用
				// v.MapIndex() 返回与map v中的键关联的值。
				if err := encode(buf,v.MapIndex(key));err != nil {
					return err
				}
				buf.WriteByte(')')
			}
			buf.WriteByte(')')

		default:
			return fmt.Errorf("对不起 ， 暂时未对此类型 %s 作出 分解操作。",v.Type())

	}

		return nil
}
                        </textarea>
                    </div>
                </article>
            </main>
        </div>
    </div>
</div>



<footer id="site-footer">
    <div class="container">
        <div class="row">
            <div class="col-md-12">
                <p class="copyright">&programKingdom@16.com 2020 - 01 - 09
                </p>
            </div>
        </div>
    </div>
</footer>

<!-- Mobile Menu -->
<div class="overlay overlay-hugeinc">
    <button type="button" class="overlay-close"><span class="ion-ios-close-empty"></span></button>
    <nav>
        <ul>
            <li><a href="index.html">HOME</a></li>
            <li><a href="full-width.html">BLOG</a></li>
            <li><a href="about.html">ABOUT</a></li>
        </ul>
    </nav>
</div>


<script src="js/script.js"></script>

</body>
</html>
